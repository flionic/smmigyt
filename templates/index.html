{% extends 'layout/main.html' %}
{% block main %}

    {% call section('row center', 'index-banner') %}
        <h5 class="white-text">Безопасное продвижение в Instagram and YouTube</h5>
        <div class="col l6 s12 center">
            <div class="icon-block white-text">
                <h2><i class="material-icons">flash_on</i></h2>
                <h5>Instagram</h5>
                <p class="light">Накрутка лайков и подписчиков<br>
                    это простые инструменты для рекламы<br>
                    в социальных сетях и гибкие возможности<br>
                    по настройке рекламных заданий</p>
            </div>
        </div>
        <div class="col l6 s12 center">
            <div class="icon-block white-text">
                <h2><i class="material-icons">flash_on</i></h2>
                <h5>YouTube</h5>
                <p class="light">Накрутка лайков и подписчиков<br>
                    это простые инструменты для рекламы<br>
                    в социальных сетях и гибкие возможности<br>
                    по настройке рекламных заданий</p>
            </div>
        </div>
    {% endcall %}

    {% call section(id='auth') %}
        {% if current_user and current_user.is_authenticated %}
            {% block protected %}
                <form id="new-task" class="col s12 m8 offset-m2">
                    <div class="card">
                        <div class="card-content">
                            <div class="row no-mar-bot">
                                <div class="input-field col m10- s12">
                                    <select id="services" data-task-param="service">
                                        <option value="" disabled selected>Мне нужно...</option>
                                        {% for s in services %}
                                            <option data-task-min="{{ s.min }}" data-task-max="{{ s.max }}"
                                                    data-task-price="{{ s.price }}"
                                                    data-task-desc="{{ s.desc }}"
                                                    value="{{ s.id }}">{{ s.title }} - {{ s.price }} р.
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <label for="services">Задание</label>
                                </div>
                            </div>
                            <div class="row no-mar-bot">
                                <div class="input-field col m6 s12">
                                    <input id="link" data-task-param="link" type="text">
                                    <label for="link" class="active">Ссылка</label>
                                </div>
                                <div class="input-field col m4 s12">
                                    <input id="quantity" class="validate" min="" max="" data-task-param="quantity" type="number">
                                    <label for="quantity">Количество</label>
                                    <span class="helper-text quantity-help"></span>
                                </div>
                                <div class="input-field col m2 s12 center">
                                    <button class="btn waves-effect waves-light green task-action" type="submit"
                                            name="submit">
                                        Заказать
                                    </button>
                                </div>
                                <div class="input-field col s12">
                                    <span class="service-desc"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            {% endblock %}
        {% else %}
            <div class="row center grey-text">
                <h6>Требуется авторизация</h6>
                <a class="btn-large waves-effect waves-light blue btn-login">Вход/Регистрация</a>
            </div>
        {% endif %}
    {% endcall %}

    {% call section() %}
        {% if current_user and current_user.is_authenticated %}
            <div class="col s12 m8 offset-m2">
                <div class="card">
                    <div class="card-content">
                        <div class="row no-mar-bot">
                            <div class="input-field col m10- s12 center">
                                <i>История заказов пуста</i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endcall %}

    {% call section() %}

        <div class="modal modal-confirm modal-login">
            {#            <div class="modal-content">#}
            {#                <h5></h5>#}
            {#            </div>#}
            <div class="modal-footer">
                <form id="auth">
                    <div class="input-field col m6 s12">
                        <input id="email" type="text" required>
                        <label for="email" class="active">Email</label>
                    </div>
                    <div class="input-field col m6 s12">
                        <input id="pass" type="password" required>
                        <label for="pass" class="active">Пароль</label>
                    </div>
                </form>
                <div class="input-field col s12">
                    <a class="btn waves-effect waves-light grey white-text signup">Зарегистрироваться</a>
                    <a class="btn waves-effect waves-light green white-text login">Войти</a>
                </div>
            </div>
        </div>

        <div class="modal modal-confirm modal-deposit">
            <div class="modal-content center">
                <h5>Пополнение баланса</h5>
            </div>
            <div class="modal-footer">
                <form id="payment" name="payment" method="post" action="https://sci.interkassa.com/" enctype="utf-8">
                    <input type="hidden" name="ik_x_userid" value="{{ current_user.id }}"/>
                    <input type="hidden" name="ik_co_id" value="{{ ik.co_id }}"/>
                    <input type="hidden" name="ik_pm_no" value="{{ ik.pm_id }}"/>
                    <input type="hidden" name="ik_cli" value="{{ current_user.email }}"/>
                    <input type="hidden" name="ik_cur" value="RUB"/>
                    {#<input type="hidden" name="ik_cur" value="RUB"/>#}
                    <input type="hidden" name="ik_desc" value="Пополнение баланса {{ current_user.email }}"/>
                    <div class="row">
                        <div class="col s12 center">
                            <div class="input-field inline">
                                <input name="ik_am" id="ik_am" class="validate" type="number" min="1" max="30000"
                                       required>
                                <label for="ik_am">Сумма</label>
                            </div>
                            <div class="input-field inline">
                                <span>Руб.</span>
                            </div>
                            <div class="input-field inline">
                                <button class="btn waves-effect waves-light green" type="submit" name="submit">К
                                    оплате<i class="material-icons right">credit_card</i></button>
                                <a href="#!" class="btn modal-close waves-effect waves-light red">Отмена</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    {% endcall %}

    {% block scripts %}
        <script type="text/javascript">
            $(document).ready(function () {
                var modals = M.Modal.init($('.modal'), {'endingTop': '30%'});
                $('.btn-login').click(function () {
                    var targetBtn = this, modalText = $('.modal-content h5');
                    {#modalText.text($(this).attr('data-tooltip') + ' заказ?');#}
                    modals[0].open();
                });
                $('.btn-deposit').click(function () {
                    var targetBtn = this, modalText = $('.modal-content h5');
                    {#modalText.text($(this).attr('data-tooltip') + ' заказ?');#}
                    modals[1].open();
                });
                $('.login').click(function () {
                    $.post("login", {"email": $('#email').val(), "password": $('#pass').val()})
                        .done(function (data) {
                            location.reload();
                        });
                });
                $('.signup').click(function () {
                    $.post("signup", {"email": $('#email').val(), "password": $('#pass').val()})
                        .done(function (data) {
                            location.reload();
                        });
                });

                $('#services').on('change', function () {
                    var serv = $('#services option:selected');
                    $('.service-desc').text(serv.attr('data-task-desc'));
                    $('.quantity-help').text('Мин: ' + serv.attr('data-task-min') + ' Макс: ' + serv.attr('data-task-max'));
                    $('#quantity').attr('min', serv.attr('data-task-min'));
                    $('#quantity').attr('max', serv.attr('data-task-max'));
                });

                {#  $('#services option:selected').attr('data-task-min');    #}
            });
        </script>
    {% endblock %}

{% endblock %}